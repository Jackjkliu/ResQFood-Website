<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Donation Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            text-align: center;
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        h3 {
            color: #666;
            font-weight: normal;
        }
        button {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 1rem;
        }
        #name-input, #phone-input, #pickup-window-input, #address-input, #product-type-input, #weight-input, #success-message {
            display: none;
        }
        input, select {
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .step.active {
            background-color: #4CAF50;
        }
        .step-line {
            flex-grow: 1;
            height: 2px;
            background-color: #ccc;
            align-self: center;
            margin: 0 5px;
        }
        .step-line.active {
            background-color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="step-indicator">
            <div class="step active">1</div>
            <div class="step-line" id="line1-2"></div>
            <div class="step" id="step2">2</div>
            <div class="step-line" id="line2-3"></div>
            <div class="step" id="step3">3</div>
            <div class="step-line" id="line3-4"></div>
            <div class="step" id="step4">4</div>
            <div class="step-line" id="line4-5"></div>
            <div class="step" id="step5">5</div>
            <div class="step-line" id="line5-6"></div>
            <div class="step" id="step6">6</div>
            <div class="step-line" id="line6-7"></div>
            <div class="step" id="step7">7</div>
        </div>
        <div id="title-screen">
            <h1>Share Your Donation Details</h1>
            <button id="start-button" onclick="startDonation()">Start</button>
        </div>
        <div id="name-input">
            <h2>What is your name?</h2>
            <input type="text" id="first-name" placeholder="First Name">
            <input type="text" id="last-name" placeholder="Last Name">
            <button onclick="nextStep('name')">Next</button>
        </div>
        <div id="phone-input">
            <h2>What's Your Phone Number?</h2>
            <h3>What's the best contact to stay in touch with your driver</h3>
            <input type="tel" id="phone-number" placeholder="+1 (___) ___-____" maxlength="17">
            <button onclick="nextStep('phone')">Next</button>
        </div>
        <div id="pickup-window-input">
            <h2>Select Pickup Window</h2>
            <div id="day-picker-container"></div>
            <div id="time-picker-container"></div>
            <button onclick="nextStep('pickup-window')">Next</button>
        </div>
        <div id="address-input">
            <h2>What's Your Address?</h2>
            <input type="text" id="address-line" placeholder="Address Line">
            <button onclick="nextStep('address')">Next</button>
        </div>
        <div id="product-type-input">
            <h2>Select Product Type</h2>
            <select id="product-type">
                <option value="" disabled selected>Enter product type</option>
                <option value="Bakery">Bakery</option>
                <option value="Produce">Produce</option>
                <option value="Meat">Meat</option>
                <option value="Dairy">Dairy</option>
                <option value="Prepared/Perishable">Prepared/Perishable</option>
                <option value="Beverages">Beverages</option>
                <option value="Nonfood">Nonfood</option>
                <option value="Mix">Mix</option>
            </select>
            <button onclick="nextStep('product-type')">Next</button>
        </div>
        <div id="weight-input">
            <h2>What's the weight of your donation?</h2>
            <h3>Please enter in pounds (lbs)</h3>
            <input type="number" id="donation-weight" placeholder="Enter weight in lbs" min="0" step="0.1">
            <button onclick="nextStep('weight')">Finish</button>
        </div>
        <div id="success-message" style="display:none;">
            <h2>Success!</h2>
            <p>Thank you for your donation. We'll be in touch soon.</p>
            <form id="sms-form" action="/send-sms" method="POST">
                <input type="hidden" id="phoneNumber" name="phoneNumber">
                <input type="hidden" id="fullMessage" name="message">
                <button type="submit">Send Confirmation SMS</button>
            </form>
        </div>
    </div>
    <script>
        function startDonation() {
            document.getElementById('title-screen').style.display = 'none';
            document.getElementById('name-input').style.display = 'block';
        }

        function formatPhoneNumber(input) {
            let number = input.value.replace(/\D/g, '');
            if (number.length > 0 && number[0] !== '1') {
                number = '1' + number;
            }
            number = number.substring(0, 11);
            
            let formattedNumber = '';
            if (number.length > 0) {
                formattedNumber = '+' + number[0];
                if (number.length > 1) {
                    formattedNumber += ' (' + number.substring(1, 4);
                }
                if (number.length > 4) {
                    formattedNumber += ') ' + number.substring(4, 7);
                }
                if (number.length > 7) {
                    formattedNumber += '-' + number.substring(7, 11);
                }
            }
            
            input.value = formattedNumber;
        }

        document.getElementById('phone-number').addEventListener('input', function(e) {
            formatPhoneNumber(e.target);
        });

        function nextStep(step) {
            if (step === 'name') {
                const firstName = document.getElementById('first-name').value;
                const lastName = document.getElementById('last-name').value;
                if (firstName && lastName) {
                    document.getElementById('name-input').style.display = 'none';
                    document.getElementById('phone-input').style.display = 'block';
                    document.getElementById('step2').classList.add('active');
                    document.getElementById('line1-2').classList.add('active');
                } else {
                    alert("Please enter both your first and last name.");
                }
            }  else if (step === 'phone') {
        const phoneNumber = document.getElementById('phone-number').value;
        if (phoneNumber.replace(/\D/g, '').length === 11) {  // Changed from 10 to 11
            document.getElementById('phone-input').style.display = 'none';
            document.getElementById('pickup-window-input').style.display = 'block';
            document.getElementById('step3').classList.add('active');
            document.getElementById('line2-3').classList.add('active');
            setupPickupWindow();
        } else {
            alert("Please enter a valid phone number in the format: +1 (XXX) XXX-XXXX");
        }
    }
            else if (step === 'pickup-window') {
                const selectedDay = document.getElementById('day-picker').value;
                const selectedTime = document.getElementById('time-picker').value;
                if (selectedDay && selectedTime) {
                    document.getElementById('pickup-window-input').style.display = 'none';
                    document.getElementById('address-input').style.display = 'block';
                    document.getElementById('step4').classList.add('active');
                    document.getElementById('line3-4').classList.add('active');
                } else {
                    alert("Please select both a day and a time slot.");
                }
            } else if (step === 'address') {
                const address = document.getElementById('address-line').value;
                if (address) {
                    document.getElementById('address-input').style.display = 'none';
                    document.getElementById('product-type-input').style.display = 'block';
                    document.getElementById('step5').classList.add('active');
                    document.getElementById('line4-5').classList.add('active');
                } else {
                    alert("Please enter your address.");
                }
            } else if (step === 'product-type') {
                const productType = document.getElementById('product-type').value;
                if (productType) {
                    document.getElementById('product-type-input').style.display = 'none';
                    document.getElementById('weight-input').style.display = 'block';
                    document.getElementById('step6').classList.add('active');
                    document.getElementById('line5-6').classList.add('active');
                } else {
                    alert("Please select a product type.");
                }
            } else if (step === 'weight') {
    const weight = document.getElementById('donation-weight').value;
    if (weight && parseFloat(weight) > 0) {
        document.getElementById('weight-input').style.display = 'none';
        document.getElementById('success-message').style.display = 'block';
        document.getElementById('step7').classList.add('active');
        document.getElementById('line6-7').classList.add('active');
        
        const phoneNumber = document.getElementById('phone-number').value;
        const firstName = document.getElementById('first-name').value;
        const lastName = document.getElementById('last-name').value;
        const address = document.getElementById('address-line').value;
        const productType = document.getElementById('product-type').value;
        const selectedDay = document.getElementById('day-picker').value;
        const selectedTime = document.getElementById('time-picker').value;
        
        const fullMessage = `New donation from ${firstName} ${lastName}. 
Phone: ${phoneNumber}
Address: ${address}
Product Type: ${productType}
Weight: ${weight} lbs
Pickup Window: ${selectedDay}, ${selectedTime}`;

        document.getElementById('phoneNumber').value = phoneNumber;
        document.getElementById('fullMessage').value = fullMessage;
    } else {
        alert("Please enter a valid weight greater than 0.");
    }
}
        }
           

        function setupPickupWindow() {
            const dayPickerContainer = document.getElementById('day-picker-container');
            const timePickerContainer = document.getElementById('time-picker-container');
            
            dayPickerContainer.innerHTML = generateDayPicker();
            
            const dayPicker = document.getElementById('day-picker');
            dayPicker.addEventListener('change', function() {
                timePickerContainer.innerHTML = generateTimePicker(this.value);
            });
        }

        function generateDayPicker() {
            const days = [];
            const today = new Date();
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            for (let i = 0; i < 10; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                let dayString;
                if (i === 0) {
                    dayString = `Today (${monthNames[date.getMonth()]} ${date.getDate()})`;
                } else if (i === 1) {
                    dayString = `Tomorrow (${monthNames[date.getMonth()]} ${date.getDate()})`;
                } else {
                    const dayOfWeek = dayNames[date.getDay()];
                    const month = monthNames[date.getMonth()];
                    const dayOfMonth = date.getDate();
                    dayString = `${dayOfWeek} ${month} ${dayOfMonth}`;
                }
                
                days.push(dayString);
            }

            return `
                <select id="day-picker" style="width: 100%; padding: 10px; font-size: 16px; margin-bottom: 10px;">
                    <option value="" disabled selected>Select pickup day</option>
                    ${days.map(day => `<option>${day}</option>`).join('')}
                </select>
            `;
        }

        function generateTimePicker(selectedDay) {
            const today = new Date();
            let dayOfWeek;

            if (selectedDay.startsWith('Today')) {
                dayOfWeek = today.toLocaleString('en-us', {weekday: 'long'});
            } else if (selectedDay.startsWith('Tomorrow')) {
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                dayOfWeek = tomorrow.toLocaleString('en-us', {weekday: 'long'});
            } else {
                dayOfWeek = new Date(selectedDay).toLocaleString('en-us', {weekday: 'long'});
            }
            
            // Assuming you have a list of available time slots for each day
            const availableTimeSlots = ['1 PM - 4 PM', '4 PM - 7 PM'];

            return `
                <select id="time-picker" style="width: 100%; padding: 10px; font-size: 16px;">
                    <option value="" disabled selected>Select pickup time</option>
                    ${availableTimeSlots.map(slot => `<option value="${slot}">${slot}</option>`).join('')}
                </select>
            `;
        }
    </script>
</body>
</html>